{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/emeka/Desktop/waste-to-energy-dashboard%20%282%29/context/waste-data-context.tsx"],"sourcesContent":["\"use client\"\n\nimport { createContext, useContext, useState, useEffect, type ReactNode, useCallback } from \"react\"\n\nexport interface WasteSubmission {\n  id: string\n  date: string\n  lga: string\n  pspOperator: string\n  tons: number\n  wasteType: string\n  energyKWh: number\n  carbonCredits: number\n}\n\ninterface WasteDataContextType {\n  submissions: WasteSubmission[]\n  addSubmission: (submission: Omit<WasteSubmission, \"id\" | \"energyKWh\" | \"carbonCredits\" | \"date\"> & { date: string }) => Promise<void>\n}\n\nconst WasteDataContext = createContext<WasteDataContextType | undefined>(undefined)\n\nexport const LGAS = [\n  \"Agege\", \"Ajeromi-Ifelodun\", \"Alimosho\", \"Amuwo-Odofin\", \"Apapa\",\n  \"Badagry\", \"Epe\", \"Eti-Osa\", \"Ibeju-Lekki\", \"Ifako-Ijaaye\",\n  \"Ikeja\", \"Ikorodu\", \"Kosofe\", \"Lagos Island\", \"Lagos Mainland\",\n  \"Mushin\", \"Ojo\", \"Oshodi-Isolo\", \"Shomolu\", \"Surulere\"\n]\n\nexport const PSP_OPERATORS = [\n  \"CleanLagos Services\",\n  \"EcoWaste Management\",\n  \"GreenCity Collectors\",\n  \"WasteNet Solutions\",\n  \"Urban Sanitation Ltd\"\n]\n\nexport const WASTE_TYPES = [\"Organic\", \"Plastic\", \"Mixed\", \"Inert\"]\n\nfunction generateMockData(): WasteSubmission[] {\n  const submissions: WasteSubmission[] = []\n  const today = new Date()\n\n  for (let i = 0; i < 50; i++) { // Increased to 50 for more data\n    const daysAgo = Math.floor(Math.random() * 14)\n    const date = new Date(today)\n    date.setDate(date.getDate() - daysAgo)\n\n    const tons = Math.round((Math.random() * 50 + 10) * 10) / 10\n    const energyKWh = tons * 650\n    const carbonCredits = tons * 0.42\n\n    submissions.push({\n      id: `mock-${i + 1}`,\n      date: date.toISOString().split(\"T\")[0],\n      lga: LGAS[Math.floor(Math.random() * LGAS.length)],\n      pspOperator: PSP_OPERATORS[Math.floor(Math.random() * PSP_OPERATORS.length)],\n      tons,\n      wasteType: WASTE_TYPES[Math.floor(Math.random() * WASTE_TYPES.length)],\n      energyKWh,\n      carbonCredits,\n    })\n  }\n  return submissions\n}\n\nexport function WasteDataProvider({ children }: { children: ReactNode }) {\n  const [submissions, setSubmissions] = useState<WasteSubmission[]>([])\n\n  const initializeData = useCallback(async () => {\n    try {\n      // 1. Generate mock data\n      let mockData = generateMockData(); // Keep mock data as a fallback\n\n      // 2. Fetch real, persisted submissions\n      const res = await fetch(\"/api/submit\")\n      // Added console.error for better debugging if API fails\n      if (!res.ok) {\n        console.error(`API fetch failed with status: ${res.status}`);\n        // If API fails, we still want to use mock data\n        throw new Error(\"Failed to fetch persisted data from API.\");\n      }\n      const persistedData = await res.json()\n\n      // 3. Combine and set the state, sorting by date\n      const combinedData = [...persistedData.submissions, ...mockData].sort(\n        (a, b) => new Date(b.date).getTime() - new Date(a.date).getTime()\n      );\n      setSubmissions(combinedData)\n    } catch (error) {\n      console.error(\"Failed to fetch submissions:\", error)\n      // Fallback to just mock data if API fails\n      setSubmissions(generateMockData())\n    }\n  }, [])\n\n  useEffect(() => {\n    initializeData()\n  }, [initializeData])\n\n  const addSubmission = async (submission: Omit<WasteSubmission, \"id\" | \"energyKWh\" | \"carbonCredits\" | \"date\"> & { date: string }) => {\n    console.log({payload: submission})\n    try {\n      console.log(\"Attempting to submit data:\", submission);\n      const res = await fetch(\"/api/submit\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(submission),\n      })\n\n      // Improved error handling for non-OK responses. This will now log the actual HTML \"Not Found\" page content if the 404 persists,\n      // which is useful for debugging if the API route is still not found.\n      // This is crucial for debugging the 404.\n      if (!res.ok) {\n        console.log({res})\n        const errorBody = await res.text();\n        console.error(\"API submission response not OK:\", res.status, errorBody); // Log the full response body\n        throw new Error(`API submission failed with status ${res.status}: ${errorBody.substring(0, 200)}...`); // Truncate for error message\n      }\n      const result = await res.json();\n      console.log(\"Submission successful, received:\", result);\n      setSubmissions((prev) => [result.data, ...prev]);\n    } catch (error) {\n      console.error(\"Failed to add submission:\", error)\n      throw error // Re-throw to allow calling component to handle\n    }\n  }\n\n  return (\n    <WasteDataContext.Provider value={{ submissions, addSubmission }}>\n      {children}\n    </WasteDataContext.Provider>\n  )\n}\n\nexport function useWasteData() {\n  const context = useContext(WasteDataContext)\n  if (context === undefined) {\n    throw new Error(\"useWasteData must be used within a WasteDataProvider\")\n  }\n  return context\n}\n"],"names":[],"mappings":"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"}}]
}